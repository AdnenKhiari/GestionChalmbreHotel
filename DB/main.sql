CREATE TABLE CLIENTS (
    id INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 300 PRIMARY KEY,
    fullname VARCHAR2(40) NOT NULL,
    address VARCHAR2(60) NOT NULL,
    date_of_birth DATE NOT NULL,
    cin VARCHAR2(20) NOT NULL UNIQUE,
    job VARCHAR2(30),
    gender CHAR CHECK (gender IN ('M', 'F')) NOT NULL,
    state CHAR CHECK (state IN ('M', 'D', 'S')) NOT NULL
);

CREATE TABLE OFFERS (
    id INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 300 PRIMARY KEY,
    name VARCHAR2(30) NOT NULL,
    description VARCHAR2(200) NOT NULL,
    date_start DATE NOT NULL,
    date_end DATE,
    price NUMERIC(10 , 5 ) NOT NULL,
    CONSTRAINT vp CHECK (price >= 0)
);


CREATE TABLE  ROOMS (
    id INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 300 PRIMARY KEY,
    room_number INT NOT NULL UNIQUE,
    capacity CHAR CHECK( capacity IN ('D', 'T', 'S', 'Q') ) NOT NULL,
    type CHAR DEFAULT 'R' CHECK(type IN ('R', 'S')) NOT NULL,
    options CHAR  DEFAULT 'D' CHECK (options IN ('D', 'P', 'S')),
    state CHAR  DEFAULT 'C' CHECK(state IN ('F', 'O', 'M', 'C'))
);

CREATE TABLE BOOKINGS (
    id INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 300 PRIMARY KEY,
    name VARCHAR(20),
    date_checkin DATE NOT NULL,
    date_checkout DATE NOT NULL
);


CREATE TABLE ROOMS_ALLOCATION (
    id INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 300 PRIMARY KEY,
    food_choice CHAR(2) CHECK(food_choice IN ('N', 'H', 'F', 'SI','AI')),
    room_id INT REFERENCES ROOMS (id),
    offer_id INT REFERENCES OFFERS (id)
);

CREATE TABLE  CLIENT_IN_ROOMS (
    client_id INT REFERENCES CLIENTS (id),
    allocated_room_id INT REFERENCES ROOMS_ALLOCATION (id),
    PRIMARY KEY (client_id , allocated_room_id)
);

CREATE TABLE BOOKING_ROOMS_ALLOCATION (
    booking_id INT REFERENCES BOOKINGS (id),
    allocated_room_id INT REFERENCES ROOMS_ALLOCATION (id),
    PRIMARY KEY (booking_id , allocated_room_id)
);

CREATE TABLE  USERS (
    id INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 300 PRIMARY KEY,
    fullname VARCHAR(40) NOT NULL,
    email VARCHAR(30) NOT NULL UNIQUE,
    password VARCHAR(60) NOT NULL,
    role CHAR DEFAULT 'A' NOT NULL CHECK(role IN ('A'))
);

CREATE TABLE SSIDS (
    ssid VARCHAR(80) PRIMARY KEY,
    user_id INT REFERENCES USERS (id)
);